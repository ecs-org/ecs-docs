
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>&lt;no title&gt; &#8212; ecs-admin-manual 2020-05-31@15:22 documentation</title>
    <link rel="stylesheet" href="_static/better.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <link rel="stylesheet" href="static/custom.css" type="text/css" />
  </head><body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>## Deploy Appliance</p>
<p>The base of the appliance is Ubuntu Xenial (16.04 LTS).
Installation is done unattended using ssh to login into the machine.</p>
<p>For a quickstart look at [github.com/ecs-org/ecs-appliance/README.md](
<a class="reference external" href="https://github.com/ecs-org/ecs-appliance/#quickstart">https://github.com/ecs-org/ecs-appliance/#quickstart</a>).</p>
<p>### As a Virtual Machine</p>
<p>You either need:
+ a standard ubuntu cloud image from [Ubunu Xenial Cloud Images](<a class="reference external" href="http://cloud-images.ubuntu.com/xenial/current/">http://cloud-images.ubuntu.com/xenial/current/</a>)</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>a cloud-init cidata iso volume with your public key</dt><dd><ul>
<li><dl class="simple">
<dt>use the prebuilt cidata iso with the vagrant user and the insecure vagrant ssh key or password</dt><dd><ul>
<li><p>[vagrant-publickey-growroot.iso](<a class="reference external" href="https://raw.githubusercontent.com/ecs-org/cidata-seed/master/vagrant-publickey-growroot.iso">https://raw.githubusercontent.com/ecs-org/cidata-seed/master/vagrant-publickey-growroot.iso</a>)</p></li>
<li><p>[vagrant-password-growroot.iso](<a class="reference external" href="https://raw.githubusercontent.com/ecs-org/cidata-seed/master/vagrant-password-growroot.iso">https://raw.githubusercontent.com/ecs-org/cidata-seed/master/vagrant-password-growroot.iso</a>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>you can build your own seed iso using [github.com/ecs-org/cidata-seed](<a class="reference external" href="https://github.com/ecs-org/cidata-seed/">https://github.com/ecs-org/cidata-seed/</a>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>an already running empty Ubuntu Xenial and a ssh key to login</dt><dd><ul>
<li><p>eg. if your rootserver hoster has a default xenial image</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>a local development machine with vagrant and a hypervisor for vagrant installed.</dt><dd><ul>
<li><p>vagrant will setup the base machine for you</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>For a virtual machine deployment it is best to stick to the default xenial cloud images layout (flat, first Partition as Root taking all space), unless there is good reason to deviate.</p>
<p>Start the new virtual machine and login via ssh.</p>
<p>### On Hardware or other custom Configurations</p>
<p>Needed:</p>
<ul class="simple">
<li><dl class="simple">
<dt>an already running empty Ubuntu Xenial and a ssh key to login</dt><dd><ul>
<li><p>eg. if your rootserver hoster has a default xenial image</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>In a typical root server hosting setup there are two harddisks per machine.
These should be configured as a raid1 (mirroring) setup with lvm on top of it.</p>
<p>Example:
+ Hardware: [Hetzner px61nvme Rootserver](<a class="reference external" href="https://www.hetzner.de/de/hosting/produkte_rootserver/px61nvme">https://www.hetzner.de/de/hosting/produkte_rootserver/px61nvme</a>)  Setup Config:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">DRIVE1</span> <span class="pre">/dev/nvme1n1</span>
<span class="pre">DRIVE2</span> <span class="pre">/dev/nvme0n1</span>
<span class="pre">SWRAID</span> <span class="pre">1</span>
<span class="pre">SWRAIDLEVEL</span> <span class="pre">1</span>
<span class="pre">BOOTLOADER</span> <span class="pre">grub</span>
<span class="pre">HOSTNAME</span> <span class="pre">Ubuntu-1604-xenial-64-minimal</span>
<span class="pre">PART</span> <span class="pre">/boot</span> <span class="pre">ext3</span> <span class="pre">512M</span>
<span class="pre">PART</span> <span class="pre">lvm</span> <span class="pre">vg0</span> <span class="pre">all</span>
<span class="pre">LV</span> <span class="pre">vg0</span> <span class="pre">root</span> <span class="pre">/</span> <span class="pre">ext4</span> <span class="pre">300G</span>
<span class="pre">IMAGE</span> <span class="pre">/root/.oldroot/nfs/install/../images/Ubuntu-1604-xenial-64-minimal.tar.gz</span>
<span class="pre">`</span></code></p>
<p>### Optional Network attached Storage</p>
<ul class="simple">
<li><p>The appliance supports two external network attached storage volumes, one for permanent data and one for volatile data.</p></li>
<li><p>To have seperate volatile and/or data partitions, change storage:ignore:volatile and/or storage:ignore:data to false.</p></li>
<li><p>The volatile volume must be labeled “ecs-volatile”, the data volume “ecs-data”.</p></li>
<li><p>Setup will add mountpoints for /data and /volatile and mount them on startup.</p></li>
<li><p>Use appliance:extra:states and :packages if storage setup needs additional packages installed.</p></li>
</ul>
<p>### Install via ssh to an empty Xenial VM</p>
<p>ssh into target vm:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">DEBIAN_FRONTEND=noninteractive</span>
<span class="pre">apt-get</span> <span class="pre">-y</span> <span class="pre">update</span> <span class="pre">&amp;&amp;</span> <span class="pre">apt-get</span> <span class="pre">-y</span> <span class="pre">install</span> <span class="pre">curl</span>
<span class="pre">curl</span> <span class="pre">https://raw.githubusercontent.com/ecs-org/ecs-appliance/master/bootstrap-appliance.sh</span> <span class="pre">&gt;</span> <span class="pre">/tmp/bootstrap.sh</span>
<span class="pre">cd</span> <span class="pre">/tmp;</span> <span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">/tmp/bootstrap.sh;</span> <span class="pre">/tmp/bootstrap.sh</span> <span class="pre">--yes</span>&#160; <span class="pre">2&gt;&amp;1</span> <span class="pre">|</span> <span class="pre">tee</span> <span class="pre">/tmp/setup.log</span>
<span class="pre">`</span></code></p>
<p>### Testinstall using Vagrant</p>
<p>on your local machine:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/ecs-org/ecs-appliance</span> <span class="pre">~/ecs-appliance</span>
<span class="pre">cd</span> <span class="pre">~/ecs-appliance</span>
<span class="pre">vagrant</span> <span class="pre">up</span>
<span class="pre">`</span></code></p>
<p>### Upgrade a developer vm</p>
<p>Requirement: you need at least 3gb total memory for the appliance, 4gb minimum if you want metrics active.</p>
<p>on a developer vm:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
# clone from public repository
git clone <a class="reference external" href="https://github.com/ecs-org/ecs-appliance">https://github.com/ecs-org/ecs-appliance</a> /app/appliance
# install saltstack and start appliance install
curl -o /tmp/bootstrap_salt.sh -L <a class="reference external" href="https://bootstrap.saltstack.com">https://bootstrap.saltstack.com</a>
sudo bash -c “mkdir -p /etc/salt; cp /app/appliance/salt/minion /etc/salt/minion; </p>
<blockquote>
<div><p>chmod +x /tmp/bootstrap_salt.sh; /tmp/bootstrap_salt.sh -X”</p>
</div></blockquote>
<p>sudo salt-call state.highstate pillar=’{“appliance”: {“enabled”: true}}’
<a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>if you also want the builder (for building the appliance image) installed:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sudo</span> <span class="pre">salt-call</span> <span class="pre">state.highstate</span> <span class="pre">pillar='{&quot;builder&quot;:</span> <span class="pre">{&quot;enabled&quot;:</span> <span class="pre">true},</span> <span class="pre">&quot;appliance&quot;:</span> <span class="pre">{&quot;enabled&quot;:</span> <span class="pre">true}}'</span>
<span class="pre">`</span></code></p>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<form class="search" action="search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">ecs-admin-manual 2020-05-31@15:22 documentation</a></li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; Copyright 2020 Medizinische Universität Wien, Medizinische Universität Innsbruck, Medizinische Universität Graz, Johannes Kepler Universität Linz, Karl Landsteiner Privatuniversität für Gesundheitswissenschaften, Land Salzburg.

  </footer>

  
  </body>
</html>