#### perform execution via cpp | dot
#include "dot-style.inc"
####################################

PROCESSFLOW("System Overview - Main Appplication Communication")

#define to ->

edge [style=dashed]

    cluster(sql,"SQL-Server")
        prod(postgresql,"PostgreSQL")
    }

    cluster(stdmail,"SmartMx Outgoing Mailserver")
        prod(smartmx,"Postfix")
    }

    prod(ecsmail,"ECS-Mailserver")

    cluster(vault,"Storage System")
        prod(storagevault,"ECS-Storage Vault")
    }

    cluster(queuing,"Queuing-Server")
        prod(redis,"Redis")
    }

    prod(ecsworker,"ECS-Queue Worker")


    cluster(tomcat,"Apache Tomcat\nvia AJP")
        prod(mocca,"Citizen Card System\nSigning System")
        prod(pdfas,"PDF-AS\nPDF Creation")
        mocca to pdfas [dir=both]
    }
    cluster(http,"Webserver")
        cluster(wsgi, "WSGI-Interface")
            prod(app,"ECS-Application")
        }
    }

    image(user,actor3.png,"User")
    cluster(user_place,"User Computer")
        prod(emailclient,"Email Client")
        prod(webclient,"Webbrowser")
        prod(javaapplet,"Java Signing Applet")
    }

user to emailclient [dir=both]
user to webclient [dir=both]
webclient to javaapplet [dir=both style=dotted]

webclient to app bidir(https)
emailclient to smartmx bidir(smtp)
javaapplet to mocca bidir(https)
javaapplet to pdfas bidir(https)

app to pdfas bidir(https)
app to mocca bidir(https)
app to postgresql bidir(sql)
app to rabbitmq unidir(ampqp)
solr to app unidir(http)

rabbitmq to ecsworker bidir(ampqp)
ecsworker to storagevault [label="storing"]
ecsworker to solr unidir(http)
ecsworker to postgresql bidir(sql)
ecsworker to ecsmail unidir(smtp)

ecsmail to smartmx bidir(smtp)
ecsmail to postgresql bidir(sql)


END
